<!doctype html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0px; padding: 0px }
  #map_canvas { height: 100% }
</style>
<script type="text/javascript"
    src="http://maps.google.com/maps/api/js?sensor=false">
</script>
<script type="text/javascript">
function initialize() {
    var latlng = new google.maps.LatLng({{ county.geom.centroid.y }}, 
        {{ county.geom.centroid.x }});
    var myOptions = {
        zoom: {{ zoom }},
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    var map = new google.maps.Map(document.getElementById("map_canvas"), 
        myOptions);
    
    var color;   
{% for zip, dict in zips_dict.iteritems %}
    color = "{% cycle '#00FF00' '#0000FF' '#FF0000' '#FF00FF' '#00FFFF' '#FFFF00' %}";

    {% for layer in dict.layers %}
    var polygon_{{ zip }}_{{ forloop.counter0 }};
    
    var coords_{{ zip }}_{{ forloop.counter0 }} = {{ layer }};
    
    polygon_{{ zip }}_{{ forloop.counter0 }} = new google.maps.Polygon({
        paths: coords_{{ zip }}_{{ forloop.counter0 }},
        strokeColor: color,
        strokeOpacity: 0.8,
        strokeWeight: 1,
        fillColor: color,
        fillOpacity: 0.20
    });
    
    polygon_{{ zip }}_{{ forloop.counter0 }}.setMap(map);
    
    var infowindow_{{ zip }}_{{ forloop.counter0 }} = new google.maps.InfoWindow({
        content: '{{ zip }}'
    });
    
    var marker_{{ zip }}_{{ forloop.counter0 }} = new google.maps.Marker({
        position: new google.maps.LatLng({{ dict.centroid.y }}, 
        {{ dict.centroid.x }}),
        map: map,
        title: '{{ zip }}'
    });
    
    google.maps.event.addListener(marker_{{ zip }}_{{ forloop.counter0 }}, 'click', function() {
        infowindow_{{ zip }}_{{ forloop.counter0 }}.open(map,marker_{{ zip }}_{{ forloop.counter0 }});
    });
    google.maps.event.addListener(polygon_{{ zip }}_{{ forloop.counter0 }}, 'click', function() {
        infowindow_{{ zip }}_{{ forloop.counter0 }}.open(map,marker_{{ zip }}_{{ forloop.counter0 }});
    });
    google.maps.event.addListener(polygon_{{ zip }}_{{ forloop.counter0 }}, 'mouseover', function() {
         polygon_{{ zip }}_{{ forloop.counter0 }}.setOptions({
               fillOpacity: 0.75,
               }); 
    });
    google.maps.event.addListener(polygon_{{ zip }}_{{ forloop.counter0 }}, 'mouseout', function() {
         polygon_{{ zip }}_{{ forloop.counter0 }}.setOptions({
               fillOpacity: 0.20,
               }); 
    });
    
    {% endfor %}
{% endfor %}
};

</script>
<style>
    body {
        font-family: sans-serif;
    }
    #map_canvas {
        width: 100%;
        height: 600px;
    }
    #zips {
        overflow: auto;
        width: 500px;
        height: 200px;
    }
    .linkOFF {color: darkblue}
    .linkON {color: white; background-color: darkblue}

</style>
</head>
<body onload="initialize()">
    <div id="map_canvas"></div>
    <div id="counties">
    {{ current_site.name }}<br/>
    {{ us_zip.code }}<br/>
    {% for us_zip in zips %}
        <div id="{{zip.code}}" class="zips linkOFF">
            <a href="javascript:polygon_{{us_zip.code}}.setOptions({fillOpacity: 0.75});">{{ us_zip.code }}</a> ({{ us_zip.geom.centroid.y }}, {{ us_zip.geom.centroid.x }})
        </div>
    {% endfor %}
    </div>
</body>
</html>
