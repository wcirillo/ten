function place_markers(map){var WGS84=new OpenLayers.Projection("EPSG:4326");marker_array=new Array;marker_style_array=new Array;marker_stylemap_array=new Array;marker_layers=new Array;marker_array=ol_map.build_location_array(eval(marker_list));marker_style_array[0]=new OpenLayers.Style({externalGraphic:"/media/images/map_pointers/markerstar.png",graphicHeight:8,graphicWidth:8});marker_stylemap_array[0]=new OpenLayers.StyleMap({"default":marker_style_array[0]});var markers=new OpenLayers.Layer.Vector("Markers",{styleMap:marker_stylemap_array[0]});var features=[];for(i=0;i<marker_array.length;i++){myPoint=new OpenLayers.Geometry.Point(marker_array[i][0],marker_array[i][1]);OpenLayers.Projection.transform(myPoint,map.displayProjection,map.getProjectionObject());features.push(new OpenLayers.Feature.Vector(myPoint))}markers.addFeatures(features);map.addLayer(markers);return markers.getDataExtent()}function place_coupon_markers(a,b){marker_style_array=new Array;marker_stylemap_array=new Array;marker_layers=new Array;var c=[];for(i=0;i<=10;i+=1){g_height=25;g_width=21;g_suffix="_"+i.toString()+".png";marker_style_array[i]=new OpenLayers.Style({externalGraphic:"/media/images/map_pointers/map_pointer"+g_suffix,graphicHeight:g_height,graphicWidth:g_width});marker_stylemap_array[i]=new OpenLayers.StyleMap({"default":marker_style_array[i]});if(i>=b.length){break}}for(i=1;i<=b.length;i++){marker_name="Markers_"+i.toString();marker_layers[i]=new OpenLayers.Layer.Vector(marker_name,{styleMap:marker_stylemap_array[i]});c=[];myPoint=new OpenLayers.Geometry.Point(b[i-1][0],b[i-1][1]);OpenLayers.Projection.transform(myPoint,a.displayProjection,a.getProjectionObject());c.push(new OpenLayers.Feature.Vector(myPoint));marker_layers[i].addFeatures(c);a.addLayer(marker_layers[i])}layer_bounds=null;for(i=1;i<marker_layers.length;i++){if(layer_bounds==null){layer_bounds=marker_layers[i].getDataExtent()}else{layer_bounds.extend(marker_layers[i].getDataExtent())}}return layer_bounds}window.google=window.google||{};google.maps=google.maps||{};(function(){function a(a){document.write("<"+'script src="'+a+'"'+' type="text/javascript"><'+"/script>")}var b=google.maps.modules={};google.maps.__gjsload__=function(a,c){b[a]=c};google.maps.Load=function(a){delete google.maps.Load;a([null,[[["http://mt0.googleapis.com/vt?lyrs=m@146&src=api&hl=en-US&","http://mt1.googleapis.com/vt?lyrs=m@146&src=api&hl=en-US&"]],[["http://khm0.googleapis.com/kh?v=80&hl=en-US&","http://khm1.googleapis.com/kh?v=80&hl=en-US&"],null,null,null,1],[["http://mt0.googleapis.com/vt?lyrs=h@146&src=api&hl=en-US&","http://mt1.googleapis.com/vt?lyrs=h@146&src=api&hl=en-US&"],null,null,"imgtp=png32&"],[["http://mt0.googleapis.com/vt?lyrs=t@126,r@146&src=api&hl=en-US&","http://mt1.googleapis.com/vt?lyrs=t@126,r@146&src=api&hl=en-US&"]],null,[[null,0,7,7,[[[33e7,124605e4],[3862e5,12936e5]],[[3665e5,1297e6],[3862e5,1320034790]]],["http://mt0.gmaptiles.co.kr/mt?v=kr1.13&hl=en-US&","http://mt1.gmaptiles.co.kr/mt?v=kr1.13&hl=en-US&"]],[null,0,8,9,[[[33e7,124605e4],[3862e5,12796e5]],[[345e6,12796e5],[3862e5,12867e5]],[[3489e5,12867e5],[3862e5,12936e5]],[[35469e4,12936e5],[3862e5,1320034790]]],["http://mt0.gmaptiles.co.kr/mt?v=kr1.13&hl=en-US&","http://mt1.gmaptiles.co.kr/mt?v=kr1.13&hl=en-US&"]],[null,0,10,19,[[[329890840,1246055600],[386930130,1284960940]],[[344646740,1284960940],[386930130,1288476560]],[[350277470,1288476560],[386930130,1310531620]],[[370277730,1310531620],[386930130,1320034790]]],["http://mt0.gmaptiles.co.kr/mt?v=kr1.13&hl=en-US&","http://mt1.gmaptiles.co.kr/mt?v=kr1.13&hl=en-US&"]],[null,3,7,7,[[[33e7,124605e4],[3862e5,12936e5]],[[3665e5,1297e6],[3862e5,1320034790]]],["http://mt0.gmaptiles.co.kr/mt?v=kr1p.12&hl=en-US&","http://mt1.gmaptiles.co.kr/mt?v=kr1p.12&hl=en-US&"]],[null,3,8,9,[[[33e7,124605e4],[3862e5,12796e5]],[[345e6,12796e5],[3862e5,12867e5]],[[3489e5,12867e5],[3862e5,12936e5]],[[35469e4,12936e5],[3862e5,1320034790]]],["http://mt0.gmaptiles.co.kr/mt?v=kr1p.12&hl=en-US&","http://mt1.gmaptiles.co.kr/mt?v=kr1p.12&hl=en-US&"]],[null,3,10,null,[[[329890840,1246055600],[386930130,1284960940]],[[344646740,1284960940],[386930130,1288476560]],[[350277470,1288476560],[386930130,1310531620]],[[370277730,1310531620],[386930130,1320034790]]],["http://mt0.gmaptiles.co.kr/mt?v=kr1p.12&hl=en-US&","http://mt1.gmaptiles.co.kr/mt?v=kr1p.12&hl=en-US&"]]],[["http://cbk0.google.com/cbk?","http://cbk1.google.com/cbk?"]],[["http://khmdb0.googleapis.com/kh?v=36&hl=en-US&","http://khmdb1.googleapis.com/kh?v=36&hl=en-US&"]],[["http://mt0.googleapis.com/mapslt?hl=en-US&","http://mt1.googleapis.com/mapslt?hl=en-US&"]],[["http://mt0.googleapis.com/mapslt/ft?hl=en-US&","http://mt1.googleapis.com/mapslt/ft?hl=en-US&"]]],["en-US","US",null,0,null,"http://maps.google.com","http://maps.gstatic.com/intl/en_us/mapfiles/","http://gg.google.com","https://maps.googleapis.com","http://maps.googleapis.com"],["http://maps.gstatic.com/intl/en_us/mapfiles/api-3/4/4a","3.4.4a"],[936849974],1,null,null,null,null,0,"",null,null,0],c)};var c=(new Date).getTime();a("http://maps.gstatic.com/intl/en_us/mapfiles/api-3/4/4a/main.js")})();var ol_map=function(){var a=new Array;var b=new Array;var c=new Array;var d;var e=new Array;var f=new Array;var g;marker_list={};b[0]={};b[1]={};options_dict={minZoomLevel:7,maxZoomLevel:17};var h=0;return{build_location_map:function(c,d){a=ol_map.build_location_array(c);lng=a[0][0];lat=a[0][1];if(d==null){map_id=0;div_map_id="displaymap"}else{ol_map.build_location_map(c);map_id=1;h=1;div_map_id="minimap"}options_dict={minZoomLevel:7,maxZoomLevel:19};var e=new OpenLayers.Projection("EPSG:4326");ol_map.build_base_layer(div_map_id,map_id);var f=(new OpenLayers.LonLat(lng,lat)).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));b[map_id].map.setCenter(f);b[map_id].map.zoomTo(14);bounds=place_coupon_markers(b[map_id].map,a);if(bounds.left==bounds.right){bounds.top-=700;bounds.bottom+=700;bounds.right+=700;bounds.left-=700}ol_map.custom_zoom(b[map_id].map,bounds,"market");if(!b[map_id].map.getCenter()){b[map_id].map.zoomToMaxExtent()}},build_base_layer:function(a,c){if(typeof a=="undefined"){a="displaymap"}if(typeof c=="undefined"){c=0}ol_map.market_map_setup(b[c]);OpenLayers.ImgPath="/media/images/";var d=new OpenLayers.Projection("EPSG:4326");var e={scales:[5e7,3e7,1e7,5e6],controls:[new OpenLayers.Control.Navigation],projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:d,buffer:0,theme:null,autoPan:true};b[c].map=new OpenLayers.Map(a,e);b[c].layers.base=new OpenLayers.Layer.Google("Google",options_dict);b[c].map.addLayer(b[c].layers.base);b[c].layers.base.poweredBy="gg_watermark";var f=new OpenLayers.Control.Panel;f.addControls([new ol_map.buildZoomControl(e)]);b[c].map.addControl(f);f.activate()},buildZoomControl:function(a){this.control=new OpenLayers.Control.PanZoomBar(a);OpenLayers.Util.extend(this.control,{draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments);a=this.position.clone();this.buttons=[];var b=new OpenLayers.Size(18,18);var c=new OpenLayers.Pixel(0,a.y);this._addButton("zoomin","map_pointers/zoom-in.png",c.add(4,0),b);this._addButton("zoomout","map_pointers/zoom-out.png",c.add(4,22),b);return this.div}});return this.control},build_location_array:function(a){var b=new Array;for(var c=0;c<a.length;c++){b[c]=new Array;if(a[c].length>1){b[c][0]=a[c][0];b[c][1]=a[c][1];if(a[c].length==3){b[c][2]=a[c][2]}else{b[c][2]=""}}}return b},setMarkerToCenter:function(c){var d=c.match(/\d+/g)-1;lng=a[d][0];lat=a[d][1];var e=(new OpenLayers.LonLat(lng,lat)).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913"));b[h].setCenter(e);return},market_map_setup:function(a){a.map=null;a.layers={};a.wkt_f=new OpenLayers.Format.WKT;a.get_ewkt=function(b){return"SRID=900913;"+a.wkt_f.write(b)};a.read_wkt=function(b){return a.wkt_f.read(b)};a.write_wkt=function(b){document.getElementById("id_geom").value=a.get_ewkt(b)}},build_markets_map:function(){options_dict={minZoomLevel:3,maxZoomLevel:5};ol_map.build_base_layer();ol_map.load_doc("state_geoms.txt")},build_color_list:function(a){switch(a){case 1:border_color="";old_border_color="#63b337";color_list=[["#9cde77",border_color],["#9cde77",border_color],["#9cde77",border_color],["#9cde77",border_color],["#9cde77",border_color],["#9cde77",border_color],["#9cde77",border_color],["#9cde77",border_color],["#9cde77",border_color],["#9cde77",border_color]];break;default:color_list=[["#f9b7e8","#cb74b4"],["#de638f","#cb74b4"],["#ae50bf","#cb74b4"],["#d57bbd","#cb74b4"],["#c66aad","#cb74b4"],["#f9b7e8","#cb74b4"],["#e799d2","#cb74b4"],["#dd8fc8","#cb74b4"],["#d57bbd","#cb74b4"],["#c66aad","#cb74b4"]];break}return color_list},build_geom_layers:function(a,f,g,h){var i=new OpenLayers.Bounds;var j;var k;var l;var m;var n="market";var o;var p=a.replace(/['"]/g,"");var q=p.split("|");var r;var s;var t=.7;if(typeof g=="undefined"){g=true}if(typeof h=="undefined"){h="normal"}r=c.length;color_type=2;s=h;if(h!="normal"){color_type=1;if(h=="whole_market"){s="county";selection_colors=ol_map.build_color_list(2);e[999]=new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:"${type}",fillColor:selection_colors[0][0].toString(),strokeColor:selection_colors[0][1].toString(),strokeWidth:1.3,graphicZIndex:1,fillOpacity:t,label:"",fontColor:"#382282",fontSize:12,fontWeight:"600",labelAlign:"cm",labelXOffset:v,labelYOffset:v-2})});d=new OpenLayers.Layer.Vector("whole_market",{styleMap:e[999],LID:h,visibility:true});b[0].map.events.on({moveend:function(a){ol_map.redraw_checked()}})}}var u=ol_map.build_color_list(color_type);for(var v=0;v<q.length;v++){q[v]=q[v].split(";");if(g){k=q[v][1]}else{k=""}o=v.toString().substring(v.toString().length-1);e[v]=new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:"${type}",fillColor:u[o][0].toString(),strokeColor:u[o][1].toString(),strokeWidth:1.3,graphicZIndex:1,fillOpacity:t,label:k,fontColor:"#382282",fontSize:12,fontWeight:"600",labelAlign:"cm",labelXOffset:v,labelYOffset:v-2})});if(q[v][0]!=""){if(q[v][2]!=undefined){l=q[v][2].toLowerCase()}layer_name=q[v][1].replace(/ /g,"_");if(s!="city"){layer_name=s+"_"+layer_name}c[r+v]=new OpenLayers.Layer.Vector(layer_name,{styleMap:e[v],mode:s,LID:l,visibility:g});geom_data1=q[v][0];m=b[0].read_wkt(geom_data1);if(h=="whole_market"){d.addFeatures([m])}c[r+v].addFeatures([m]);j=m.geometry.getBounds();i.extend(j);b[0].map.addLayers([c[r+v]])}}if(f==true){var w=new OpenLayers.Control.SelectFeature(c,{hover:true,highlightOnly:true,renderIntent:"temporary"});var x=new OpenLayers.Control.SelectFeature(c,{clickout:true,click:true,single:true,onSelect:function(a){window.location="/"+a.layer.LID.toString().replace(/\s/g,"").replace(" ","-")+"/"}});b[0].map.addControl(w);b[0].map.addControl(x);w.activate();x.activate()}if(h!="zip"&&h!="city"){var y=window.location.href.toLowerCase();if(y.indexOf("hawaii")+b[0].map.getLayersByName("county_Honolulu").length+b[0].map.getLayersByName("county_Kauai").length>0){n="hawaii"}else if(b[0].map.getLayersByName("county_Anchorage").length+b[0].map.getLayersByName("county_Aleutians_West").length>0){n="alaska"}ol_map.custom_zoom(b[0].map,i,n);if(!b[0].map.getCenter()){b[0].map.zoomToMaxExtent()}}},build_geoms_for_single_market:function(a,b,c,d){ol_map.build_base_layer();ol_map.build_geom_layers(a,b,c,d)},build_market_map:function(a){options_dict={minZoomLevel:0,maxZoomLevel:10};ol_map.build_geoms_for_single_market(a,false)},build_state_map:function(a,b,c,d){options_dict={minZoomLevel:4,maxZoomLevel:7};ol_map.build_geoms_for_single_market(a,b,c,d)},build_map_selector:function(a,c,e){var f=document.getElementById("map_counties").value.replace(/['"]/g,"");options_dict={minZoomLevel:0,maxZoomLevel:10};ol_map.build_geoms_for_single_market(f,a=a,c=c,e=e);b[0].map.addLayers([d]);b[0].map.setLayerIndex(b[0].map.getLayersBy("name","whole_market")[0],1)},custom_zoom:function(a,b,c){if(typeof c=="undefined"){c="default"}switch(c){case"alaska":myZoom=4;lonCenter=-152.5341796875;latCenter=62.257014469733924;break;case"hawaii":myZoom=7;lonCenter=-157.8583333;latCenter=21.3069444;break;case"market":a.zoomToExtent(b);return;case"continent":default:myZoom=3;lonCenter=-110.683333;latCenter=50.033333;break}myPoint=new OpenLayers.Geometry.Point(lonCenter,latCenter);OpenLayers.Projection.transform(myPoint,a.displayProjection,a.getProjectionObject());a.setCenter(new OpenLayers.LonLat(myPoint.x,myPoint.y),myZoom);return},build_country_map:function(){var a=new OpenLayers.Bounds;var c;var d=document.getElementById("id_geom").value.replace(/['"]/g,"");var f=d.split("|");var g=new Array;var h;for(var i=0;i<f.length-1;i++){f[i]=f[i].split(";");e[i]=new OpenLayers.StyleMap({"default":new OpenLayers.Style({pointRadius:"${type}",fillColor:"#dd8fc8",strokeColor:"#cb74b4",strokeWidth:1.25,graphicZIndex:1,fillOpacity:.2,label:f[i][1],fontColor:"#fbcf79",fontSize:1,fontWeight:"000"})});g[i]=new OpenLayers.Layer.Vector("Layer_"+i,{styleMap:e[i],LID:f[i][1],rendererOptions:{yOrdering:false,zIndexing:true}});b[0].map.addLayers([g[i]]);if(f[i][0]!=""){geom_data1=f[i][0];h=b[0].read_wkt(geom_data1);g[i].addFeatures([h])}}var j=new OpenLayers.Control.SelectFeature(g,{hover:true,highlightOnly:true,renderIntent:"temporary"});var k=new OpenLayers.Control.SelectFeature(g,{clickout:true,click:true,single:true,onSelect:function(a){window.location="/map/"+a.layer.LID.toString().replace(/\s/g,"").replace(" ","-")+"/"}});b[0].map.addControl(j);b[0].map.addControl(k);j.activate();k.activate();place_markers(b[0].map);ol_map.custom_zoom(b[0].map,a,"continent")},display_layer:function(a){this_layer=b[0].map.getLayersBy("name",a)[0];if(!IE7){this_layer.setVisibility(false);try{this_layer.setVisibility(true)}catch(c){}}unique_val=true;for(i=0;i<f.length;i++){if(f[i][0]==a){unique_val=false;break}}if(unique_val){j=f.length;f[j]=new Array;f[j][0]=a;f[j][1]=0;f[j][2]=this_layer.mode}},hide_layer:function(a){if(!IE7){b[0].map.getLayersBy("name",a)[0].setVisibility(false)}for(i=0;i<f.length;i++){if(f[i][0]==a){f.splice(i,1)}}b[0].map.getLayersBy("name","whole_market")[0].redraw();ol_map.redraw_checked()},redraw_checked:function(){for(i=0;i<f.length;i++){this_layer=b[0].map.getLayersBy("name",f[i][0])[0];if(this_layer.mode=="county"){this_layer.redraw()}}},adjust_zip_zone:function(a,c){var d;var e;var f;central_zip=b[0].map.getLayersBy("name",a)[0];if(central_zip==undefined){return false}centroid=central_zip.features[0].geometry.getCentroid();for(var g=b[0].map.layers.length-1;g>=0;g--){if(b[0].map.layers[g].mode=="zip"){d=b[0].map.layers[g].features[0].geometry.getCentroid();e=new OpenLayers.Geometry.LineString([centroid,d]);if(centroid==d||e.getGeodesicLength(new OpenLayers.Projection("EPSG:900913"))<=c*1609.344){ol_map.display_layer(b[0].map.layers[g].name)}else if(b[0].map.layers[g].visibility){ol_map.hide_layer(b[0].map.layers[g].name)}}}return true},clear_zip_selections:function(){for(n=0;n<f.length;n++){if(b[0].map.getLayersBy("name",f[n][0])[0].mode=="zip"){ol_map.hide_layer(b[0].map.getLayersBy("name",f[n][0])[0].name);n-=1}}},report_selected_geoms:function(){selected_array=new Array;for(n=0;n<f.length;n++){selected_array[selected_array.length]=f[n][0]}return selected_array},load_doc:function(a){var b;var c;if(a.indexOf("state_geoms")>-1){c="/media/data/"}else{c="/media/dynamic/map-data/"}if(window.XMLHttpRequest){b=new XMLHttpRequest}else{b=new ActiveXObject("Microsoft.XMLHTTP")}b.onreadystatechange=function(){if(b.readyState==4&&b.status==200){if(a.indexOf("state_geoms")>-1){document.getElementById("id_geom").value=b.responseText;ol_map.build_country_map()}else{marker_list=b.responseText;ol_map.build_markets_map()}}};b.open("GET",c+a,true);b.send()},create_market_list:function(){ol_map.load_doc("market-geom-markers.txt")}}}()